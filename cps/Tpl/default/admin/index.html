<include file="public:header" />
<body class="fixed-left">
    <!-- Begin page -->
    <div id="wrapper">
        <include file="public:topBar" />
        <include file="public:leftMenu" />
        <!-- <div class="content-page" page="users"> -->
        <div class="content-page" page="{$Think.MODULE_NAME}_{$Think.ACTION_NAME}">
            <!-- Start content -->
            <div class="content">
                <div class="container">
                    <!-- Page-Title -->
                    <div class="row">
                        <div class="col-sm-12">
                            <h4 class="page-title">用户管理</h4>
                            <ol class="breadcrumb">
                                <!-- <li><a href="#">Ubold</a></li>
                                <li><a href="#">eCommerce</a></li>
                                <li class="active">Orders</li>
                                -->
                            </ol>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <ul class="nav nav-tabs tabs">
                                <li class="active tab">
                                    <a href="#home" data-toggle="tab" aria-expanded="false">
                                        <span class="visible-xs">
                                            <i class="fa fa-home"></i>
                                        </span>
                                        <span class="hidden-xs">用户列表</span></a>
                                </li>
                                <li class="tab">
                                    <a href="#home-2" data-toggle="tab" aria-expanded="false">
                                        <span class="visible-xs">
                                            <i class="fa fa-home"></i>
                                        </span>
                                        <span class="hidden-xs">添加新用户</span></a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="home">
                                        <div class="row m-t-10 m-b-10">
                                            <!-- <form role="form" method="POST"> -->
                                            <form role="form" method="get">
                                            <div class="col-sm-4 col-lg-6">
                                                


                                                <if condition="$_SESSION['admin_info']['role_id'] eq 1">
                                                <div class="col-md-6">
                                                    <input type="text" id="search" class="form-control" placeholder="搜索用户名、账号名称..." name="keyword" value="{$keyword}">
                                                </div>
                                                <div class="col-md-6">
                                                    <select class="form-control" name="role_id">
                                                        <option value="0">全部分类</option>
                                                        <volist name="roles" id="val">
                                                            <option value="{$val.id}" <if condition="$role_id eq $val['id']">selected="selected"</if>>{$val.name}</option></volist>
                                                    </select>
                                                </div>
                                                <else />
                                                <div class="col-md-12">
                                                    <input type="text" id="search" class="form-control" placeholder="搜索用户名、账号名称..." name="keyword" value="{$keyword}">
                                                </div>

                                                </if>
                                                </div>
                                                <!-- <div class="col-md-2">
                                                <select class="selectpicker m-b-0" multiple data-max-options="1" data-style="btn-white">
                                                <option selected="">全部类目</option>
                                                <option>分行</option>
                                                <option>子机构</option>
                                                <option>客户经理</option></select></div> -->
                                                <div class="col-md-2">
                                                    <input type="hidden" name="m" value="{$Think.MODULE_NAME}" />
                                                    <input type="hidden" name="a" value="{$Think.ACTION_NAME}" />
                                                    <button class="btn btn-primary waves-effect waves-light">查询</button>

                                                    <button class="btn btn-primary waves-effect waves-light" name="dosubmit" value="2">导出</button>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="table-responsive">
                                            <!-- <table class="table table-actions-bar"> -->
                                            <table class="table table-hover mails m-0">
                                                <thead>
                                                    <tr>
                                                        <!-- <th width=60>{:L('id')}</th> -->
                                                        <!-- <th width=30><input type="checkbox" value="" id="check_box" onclick="selectall('id[]');"></th> -->
                                                        <th width=100>账号名称</th>
                                                        <th>姓名</th>
                                                        <th>{:L('role_id')}</th>
                                                        <th>上级</th>
                                                        <th>电话</th>
                                                        <th>结算账号</th>
                                                        <!-- <th>地址</th> -->
                                                        <th>{:L('add_time')}</th>
                                                        <!-- <th>{:L('last_time')}</th> -->
                                                        <th width=60>{:L('status')}</th>
                                                        <th width=60>{:L('operational')}</th></tr>
                                                </thead>
                                                <tbody>
                                                    <volist name="admin_list" id="val">
                                                        <tr>
                                                            <!-- <td>{$val.id}</td> -->
                                                            <!-- <td>
                                                            <input type="checkbox" value="{$val.id}" name="id[]" <if condition="$val['user_name'] eq 'admin'">disabled="disabled"</if>></td> -->
                                                            <td>{$val.user_name}</td>
                                                            <td>{$val.user_id}</td>
                                                            <td>{$val.role_name}[{$val.role_id}]</td>
                                                            <td>{$val.pid_name}[{$val.id}]</td>
                                                            <td>{$val.mobile}</td>
                                                            <td>{$val.account}</td>
                                                            <!-- <td>{$val.address}</td> -->
                                                            <!-- <td>{$val.parent.user_name}</td> -->
                                                            <!-- <td>{$val.add_time|date='Y-m-d H:i:s',###}</td> -->
                                                            <td>{$val.add_time|date='Y-m-d',###}</td>
                                                            <!-- <td>{$val.last_time|date='Y-m-d H:i:s',###}</td> -->
                                                            <td onclick="status({$val.id},'status')" id="status_{$val.id}">
                                                                <img src="__ROOT__/statics/images/status_{$val.status}.gif" /></td>
                                                            <!-- <td><a href="javascript:edit({$val.id},'{$val.user_name}')">编辑</a></td> -->
                                                            <td>
                                                                <a href="{:u('admin/pwd',array('id'=>$val['id']))}">编辑</a></td>
                                                            <!-- <td><a href="{:u('admin/pwd', array('id'=>$val['id']))}">{$val.id}</a></td> --></tr>
                                                    </volist>
                                                </tbody>
                                            </table>
                                            </div><div id="pages">{$page}</div>
                                    <!-- </div> -->
                                </div>
                                <!-- <div class="card-box"> -->
                                <div class="tab-content">
                                    <div class="tab-pane" id="home-2">
                                    
                                        <form role="form2" method="post" action="{:u('admin/add')}" enctype="multipart/form-data">
                                            <div class="form-group m-b-0">
                                                <label class="control-label">选择Excel文件进行上传</label>
                                                <input type="file" class="filestyle" data-buttonname="btn-primary" id="filestyle-4" tabindex="-1" style="position: absolute; clip: rect(0px, 0px, 0px, 0px);" name="file">
                                                <div class="bootstrap-filestyle input-group">
                                                    <input type="text" class="form-control " placeholder="">
                                                    <span class="group-span-filestyle input-group-btn" tabindex="0">
                                                        <label for="filestyle-4" class="btn btn-primary ">
                                                            <span class="icon-span-filestyle glyphicon glyphicon-folder-open"></span>
                                                            <span class="buttonText">选择文件</span></label>
                                                    </span>
                                                </div>
                                                <p style="min-height:10px; display: block;">&nbsp;</p>
                                                <button class="btn btn-default btn-block text-uppercase waves-effect waves-light btn-lg" type="submit" name="dosubmit" value="2">导入用户</button></div>
                                            
                                            <div class="tab-pane" id="messages-2"></div>
                                        </form>
                                        <br/>
                                            <br/>


                                        <form class="form-horizontal m-t-20" method="POST" action="{:u('admin/add')}">
                                            <div class="form-group">
                                                <label for="number">账号名称</label>
                                                <input type="text" class="form-control" id="number" placeholder="{$admin_info.user_name}" value="{$admin_info.user_name}" name="user_name"></div>
                                            <div class="form-group">
                                                <label for="name">姓名</label>
                                                <input type="name" class="form-control" id="name" placeholder="{$admin_info.user_id}" value="{$admin_info.user_id}" name="user_id"></div>
                                            <div class="form-group">
                                                <label for="number">电话</label>
                                                <input type="text" class="form-control" id="number" placeholder="{$admin_info.mobile}" value="{$admin_info.mobile}" name="mobile"></div>
                                            <div class="form-group">
                                                <label for="number">地址</label>
                                                <input type="text" class="form-control" id="number" placeholder="{$admin_info.address}" value="{$admin_info.address}" name="address"></div>
                                            <div class="form-group">
                                                <label for="number">电子信箱</label>
                                                <input type="text" class="form-control" id="number" placeholder="{$admin_info.email}" value="{$admin_info.email}" name="email"></div>
                                            <div class="form-group">
                                                <label for="number">结算账户</label>
                                                <input type="text" class="form-control" id="number" placeholder="{$admin_info.account}" value="{$admin_info.account}" name="account"></div>

                                            <if condition="$_SESSION['admin_info']['role_id'] eq 4">
                                            <div class="form-group">
                                                <label for="number">{:L('role_id')}</label>
                                                <select name="role_id" class="form-control"  disabled="disabled">
                                                    <volist name="role_list" id="val">
                                                        <option value="{$val.id}" <if condition="5 eq $val['id']">selected="selected"</if>>{$val.name}</option></volist>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="number">所属机构</label>
                                                <select name="pid" class="form-control"  disabled="disabled">
                                                    <option value="0" <if condition="$_SESSION['admin_info']['id'] eq 0">selected="selected"</if>>--顶级--</option>
                                                    <volist name="admin_list3['parent']" id="val">
                                                        <option value="{$val.id}" <if condition="$_SESSION['admin_info']['id'] eq $val['id']">selected="selected"</if>>{$val.user_id}</option>
                                                        <notempty name="admin_list3['sub'][$val['id']]">
                                                            <volist name="admin_list3['sub'][$val['id']]" id="sval">
                                                                <option value="{$sval.id}" <if condition="$_SESSION['admin_info']['id']  eq $sval['id']">selected="selected"</if>>&nbsp;&nbsp;&nbsp;&nbsp;{$sval.user_id}</option>
                                                                <notempty name="admin_list3['sub'][$sval['id']]">
                                                                    <volist name="admin_list3['sub'][$sval['id']]" id="ssval">
                                                                        <option value="{$ssval.id}" <if condition="$_SESSION['admin_info']['id']  eq $ssval['id']">selected="selected"</if>>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$ssval.user_id}</option></volist>
                                                                </notempty>
                                                            </volist>
                                                        </notempty>
                                                    </volist>
                                                </select>
                                            </div>
                                            <elseif condition="$_SESSION['admin_info']['role_id'] eq 5" />
                                            <div class="form-group">
                                                <label for="number">{:L('role_id')}</label>
                                                <select name="role_id" class="form-control"  disabled="disabled">
                                                    <volist name="role_list" id="val">
                                                        <option value="{$val.id}" <if condition="6 eq $val['id']">selected="selected"</if>>{$val.name}</option></volist>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="number">所属机构</label>
                                                <select name="pid" class="form-control"  disabled="disabled">
                                                    <option value="0" <if condition="$_SESSION['admin_info']['id'] eq 0">selected="selected"</if>>--顶级--</option>
                                                    <volist name="admin_list3['parent']" id="val">
                                                        <option value="{$val.id}" <if condition="$_SESSION['admin_info']['id'] eq $val['id']">selected="selected"</if>>{$val.user_id}</option>
                                                        <notempty name="admin_list3['sub'][$val['id']]">
                                                            <volist name="admin_list3['sub'][$val['id']]" id="sval">
                                                                <option value="{$sval.id}" <if condition="$_SESSION['admin_info']['id']  eq $sval['id']">selected="selected"</if>>&nbsp;&nbsp;&nbsp;&nbsp;{$sval.user_id}</option>
                                                                <notempty name="admin_list3['sub'][$sval['id']]">
                                                                    <volist name="admin_list3['sub'][$sval['id']]" id="ssval">
                                                                        <option value="{$ssval.id}" <if condition="$_SESSION['admin_info']['id']  eq $ssval['id']">selected="selected"</if>>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$ssval.user_id}</option></volist>
                                                                </notempty>
                                                            </volist>
                                                        </notempty>
                                                    </volist>
                                                </select>
                                            </div>
                                            <else />
                                            <div class="form-group">
                                                <label for="number">{:L('role_id')}</label>
                                                <select name="role_id" class="form-control"  >
                                                    <volist name="role_list" id="val">
                                                        <option value="{$val.id}" <if condition="$admin_info['role_id'] eq $val['id']">selected="selected"</if>>{$val.name}</option></volist>
                                                </select>
                                            </div>

                                            <div class="form-group">
                                                <label for="number">所属机构</label>
                                                <select name="pid" class="form-control"  >
                                                    <option value="0" <if condition="$_SESSION['admin_info']['id'] eq 0">selected="selected"</if>>--顶级--</option>
                                                    <volist name="admin_list3['parent']" id="val">
                                                        <option value="{$val.id}" <if condition="$_SESSION['admin_info']['id'] eq $val['id']">selected="selected"</if>>{$val.user_id}</option>
                                                        <notempty name="admin_list3['sub'][$val['id']]">
                                                            <volist name="admin_list3['sub'][$val['id']]" id="sval">
                                                                <option value="{$sval.id}" <if condition="$_SESSION['admin_info']['id']  eq $sval['id']">selected="selected"</if>>&nbsp;&nbsp;&nbsp;&nbsp;{$sval.user_id}</option>
                                                                <notempty name="admin_list3['sub'][$sval['id']]">
                                                                    <volist name="admin_list3['sub'][$sval['id']]" id="ssval">
                                                                        <option value="{$ssval.id}" <if condition="$_SESSION['admin_info']['id']  eq $ssval['id']">selected="selected"</if>>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{$ssval.user_id}</option></volist>
                                                                </notempty>
                                                            </volist>
                                                        </notempty>
                                                    </volist>
                                                </select>
                                            </div>
                                            </if>

                                            
                                            <div class="form-group">
                                                <label for="number">{:L('status')}</label>
                                                <td>
                                                    <input type="radio" name="status" class="radio_style" value="1" <if condition="$admin_info.status eq 1">checked</if>> &nbsp;有效&nbsp;&nbsp;&nbsp;
                                                    <input type="radio" name="status" class="radio_style" value="0" <if condition="$admin_info.status eq 0">checked</if>> &nbsp;禁用</td></div>
                                            <!-- <button type="submit" class="btn btn-default waves-effect waves-light" name="dosubmit" value="1">确定</button> -->
                                            <button type="submit" class="btn-default btn-block text-uppercase waves-effect waves-light btn-lg" name="dosubmit" value="1">确定</button></form>
                                        
                                        <!-- </div> --></div>
                                </div>
                            </div>
                        </div>
                        <!-- end col --></div>
                </div>
            </div>
            <!-- container --></div>
        <!-- content --></div>
    <script language="javascript">function edit(id, name) {
            var lang_edit = "{$Think.lang.edit}";
            window.top.art.dialog({
                id: 'edit'
            }).close();
            window.top.art.dialog({
                title: lang_edit + '--' + name,
                id: 'edit',
                iframe: '?m=admin&a=edit&id=' + id,
                width: '480',
                height: '520'
            },
            function() {
                var d = window.top.art.dialog({
                    id: 'edit'
                }).data.iframe;
                d.document.getElementById('dosubmit').click();
                return false;
            },
            function() {
                window.top.art.dialog({
                    id: 'edit'
                }).close()
            });
        }

        function status(id, type) {
            $.get("{:u('admin/status')}", {
                id: id,
                type: type
            },
            function(jsondata) {
                var return_data = eval("(" + jsondata + ")");
                // $("#" + type + "_" + id + " img").attr('src', '__ROOT__/statics/images/status_' + return_data.data + '.gif');
                $("#" + type + "_" + id + " img").attr('src', '__ROOT__/statics/images/status_' + return_data + '.gif');
            });
        }</script>
    <include file="public:footer" />